name: Web Components Tests > Input component renders with correct attributes
steps:
  - step: I have the environment variable "PAGEFIND_SITE" set to "public"
  - step: I have a "public/index.html" file with the content {html}
    html: |-
      <!DOCTYPE html><html lang="en"><head>
      <link href="/pagefind/pagefind-component-ui.css" rel="stylesheet">
      </head><body>
      <pagefind-config preload></pagefind-config>
      <pagefind-input id="default"></pagefind-input>
      <pagefind-input id="custom-placeholder" placeholder="Find something..."></pagefind-input>
      <pagefind-summary></pagefind-summary>
      <pagefind-results></pagefind-results>
      <script src="/pagefind/pagefind-component-ui.js" type="module"></script>
      </body></html>
  - step: I have a "public/cat/index.html" file with the content {html}
    html: >-
      <!DOCTYPE html><html
      lang="en"><head></head><body><h1>Cat Page</h1><p>This page is about
      cats.</p></body></html>
  - macro: I run Pagefind
  - step: stdout should contain "Running Pagefind"
  - step: The file "public/pagefind/pagefind.js" should not be empty
  - step: I serve the directory "public"
  - step: In my browser, I load "/"
  - snapshot: In my browser, the result of {js}
    js: |-
      let wrapper = await toolproof.querySelector("#default .pf-input-wrapper");
      let input = wrapper.querySelector("input");
      return [
        `wrapper aria-label: ${wrapper.getAttribute("aria-label")}`,
        `input class: ${input.className}`,
        `input placeholder: ${input.placeholder}`
      ].join("\n");
    snapshot_content: |-
      ╎wrapper aria-label: Search this site
      ╎input class: pf-input
      ╎input placeholder: Search
  - snapshot: In my browser, the result of {js}
    js: |-
      let input = await toolproof.querySelector("#custom-placeholder input");
      return `placeholder: ${input.placeholder}`;
    snapshot_content: |-
      ╎placeholder: Find something...
  - step: In my browser, I evaluate {js}
    js: |-
      let defaultInput = await toolproof.querySelector("#default input");
      defaultInput.focus();
      defaultInput.value = "cat";
      defaultInput.dispatchEvent(new Event('input', {bubbles: true}));
  - step: In my browser, the console should be empty
  - step: In my browser, I evaluate {js}
    js: |-
      let summary = await toolproof.querySelector("pagefind-summary");
      await toolproof.waitFor(() => summary.textContent.includes("1") && summary.textContent.includes("cat"));
  - step: In my browser, I evaluate {js}
    js: |-
      let defaultComponent = await toolproof.querySelector("#default");
      let clearButton = defaultComponent.querySelector(".pf-input-clear");
      toolproof.assert(clearButton !== null, "Clear button should exist");
      toolproof.assert(!clearButton.hasAttribute("data-pf-suppressed"), "Clear button should not be suppressed when input has value");
  - step: In my browser, I evaluate {js}
    js: |-
      let defaultComponent = await toolproof.querySelector("#default");
      let clearButton = defaultComponent.querySelector(".pf-input-clear");
      let input = defaultComponent.querySelector("input");
      clearButton.click();
      await toolproof.waitFor(() => input.value === "");
  - step: In my browser, I evaluate {js}
    js: |-
      let defaultInput = await toolproof.querySelector("#default input");
      await toolproof.waitFor(() => document.activeElement === defaultInput);
  - step: In my browser, I evaluate {js}
    js: |-
      let defaultComponent = await toolproof.querySelector("#default");
      let clearButton = defaultComponent.querySelector(".pf-input-clear");
      toolproof.assert(clearButton.hasAttribute("data-pf-suppressed"), "Clear button should be suppressed when input is empty");
