name: Web Components Tests > Results show-images displays thumbnails
steps:
  - step: I have the environment variable "PAGEFIND_SITE" set to "public"
  - step: I have a "public/index.html" file with the content {html}
    html: |-
      <!DOCTYPE html><html lang="en"><head>
      <link href="/pagefind/pagefind-component-ui.css" rel="stylesheet">
      </head><body>
      <pagefind-config preload></pagefind-config>
      <pagefind-input></pagefind-input>
      <pagefind-results show-images></pagefind-results>
      <script src="/pagefind/pagefind-component-ui.js" type="module"></script>
      </body></html>
  - step: I have a "public/cat/index.html" file with the content {html}
    html: |-
      <!DOCTYPE html><html lang="en"><head></head><body>
      <img data-pagefind-meta="image[src], image_alt[alt]" src="/cat.jpg" alt="A cute cat" />
      <h1>Cat Page</h1>
      <p>This page is about cats.</p>
      </body></html>
  - step: I have a "public/dog/index.html" file with the content {html}
    html: |-
      <!DOCTYPE html><html lang="en"><head></head><body>
      <h1>Dog Page</h1>
      <p>This page is about dogs with no image.</p>
      </body></html>
  - macro: I run Pagefind
  - step: stdout should contain "Running Pagefind"
  - step: The file "public/pagefind/pagefind.js" should not be empty
  - step: I serve the directory "public"
  - step: In my browser, I load "/"
  - step: In my browser, I click the selector "pagefind-input input"
  - step: In my browser, I type "page"
  - step: In my browser, the console should be empty
  - step: In my browser, I evaluate {js}
    js: |-
      let results = await toolproof.querySelector("pagefind-results ul");
      await toolproof.waitFor(() => results.querySelectorAll("li a").length === 2);
  - snapshot: In my browser, the result of {js}
    js: |-
      let results = await toolproof.querySelector("pagefind-results ul");
      let catResult = Array.from(results.querySelectorAll("li")).find(li => li.textContent.includes("Cat"));
      let img = catResult.querySelector("img");
      return img.outerHTML;
    snapshot_content: |-
      â•Ž<img class="pf-result-image" src="/cat.jpg" alt="A cute cat">
  - step: In my browser, I evaluate {js}
    js: |-
      let results = await toolproof.querySelector("pagefind-results ul");
      let dogResult = Array.from(results.querySelectorAll("li")).find(li => li.textContent.includes("Dog"));
      toolproof.assert(dogResult !== null, "Dog result should exist");
